<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ft_transcendance</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-sky-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800">
    <main class="flex flex-col items-center space-y-10">
      <!-- Home view -->
      <div id="main-buttons" class="flex flex-col items-center space-y-10">
        <button id="btn-login" class="relative px-12 py-5 rounded-2xl bg-blue-600 text-white text-xl font-semibold shadow-xl transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl hover:bg-blue-700 active:translate-y-0.5 focus:outline-none focus:ring-4 focus:ring-blue-300">
          Login
        </button>

        <button id="btn-settings" class="relative px-12 py-5 rounded-2xl bg-gray-200 text-gray-900 text-xl font-semibold shadow-xl transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl hover:bg-gray-300 active:translate-y-0.5 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-400/60 dark:focus:ring-gray-500/60">
          Settings
        </button>
      </div>

      <!-- Login view -->
      <div id="login-options" class="hidden flex flex-col items-center space-y-6 bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-xl w-full max-w-sm">
        <input type="email"    placeholder="Email address" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:bg-gray-700 dark:text-white" />
        <input type="password" placeholder="Password"      class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:bg-gray-700 dark:text-white" />

        <button class="w-full px-6 py-3 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600 transition">
          Sign in with Google
        </button>

        <button id="btn-signin" class="w-full px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">
          Sign in
        </button>

        <button id="btn-to-signup" class="w-full text-sm text-blue-600 hover:underline dark:text-blue-400">
          Create an account
        </button>
      </div>

      <!-- Sign-up view -->
      <div id="signup-form" class="hidden flex flex-col items-center space-y-6 bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-xl w-full max-w-sm">
        <input type="text"     placeholder="Username"       class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:bg-gray-700 dark:text-white" />
        <input type="email"    placeholder="Email address"  class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:bg-gray-700 dark:text-white" />
        <input type="password" placeholder="Password"       class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:bg-gray-700 dark:text-white" />

        <button class="w-full px-6 py-3 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600 transition">
          Sign up with Google
        </button>

        <button id="btn-valid-signup" class="w-full px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">
          Create account
        </button>
      </div>

      <!-- Settings view -->
      <div id="language-settings" class="hidden flex flex-col items-center space-y-6 bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-xl">
        <div class="flex flex-col items-start space-y-4">
          <label class="flex items-center space-x-2 text-lg text-gray-900 dark:text-gray-100"><input type="radio" name="language" value="fr" checked class="accent-blue-600" /><span>French</span></label>
          <label class="flex items-center space-x-2 text-lg text-gray-900 dark:text-gray-100"><input type="radio" name="language" value="en" class="accent-blue-600" /><span>English</span></label>
          <label class="flex items-center space-x-2 text-lg text-gray-900 dark:text-gray-100"><input type="radio" name="language" value="zh" class="accent-blue-600" /><span>Chinese</span></label>
        </div>

        <button id="btn-back" class="mt-6 px-8 py-3 rounded-xl bg-gray-300 text-gray-900 font-medium text-lg hover:bg-gray-400 dark:bg-gray-600 dark:text-white dark:hover:bg-gray-500 transition">
          Back
        </button>
      </div>
    </main>

    <script type="module">
      /* ----------- SPA navigation ----------- */
      const loginBtn       = document.getElementById("btn-login");
      const settingsBtn    = document.getElementById("btn-settings");
      const backBtn        = document.getElementById("btn-back");
      const toSignUpBtn    = document.getElementById("btn-to-signup");

      const mainButtons      = document.getElementById("main-buttons");
      const loginOptions     = document.getElementById("login-options");
      const signupForm       = document.getElementById("signup-form");
      const languageSettings = document.getElementById("language-settings");

      function showView(view) {
        [mainButtons, loginOptions, signupForm, languageSettings]
          .forEach(el => el.classList.add("hidden"));

        if (view === "login")      loginOptions.classList.remove("hidden");
        else if (view === "signup") signupForm.classList.remove("hidden");
        else if (view === "settings") languageSettings.classList.remove("hidden");
        else mainButtons.classList.remove("hidden");
      }

      loginBtn    .addEventListener("click", () => { history.pushState({ page:"login" },     "", "login");     showView("login"); });
      settingsBtn .addEventListener("click", () => { history.pushState({ page:"settings" },  "", "settings");  showView("settings"); });
      backBtn     .addEventListener("click", () => { history.pushState({ page:"home" },      "", "home");      showView("home"); });
      toSignUpBtn .addEventListener("click", () => { history.pushState({ page:"signup" },    "", "signup");    showView("signup"); });

      window.addEventListener("popstate", e => showView(e.state?.page || "home"));

      window.addEventListener("load", () => {
        const hash = location.hash.replace("#", "");
        showView(hash || "home");
        if (!history.state) history.replaceState({ page: hash || "home" }, "", location.href);
      });

      /* ----------- Sign-up ----------- */
      const signupBtn = document.getElementById("btn-valid-signup");
      signupBtn.addEventListener("click", async () => {
        const inputs   = signupForm.querySelectorAll("input");
        const pseudo   = inputs[0].value.trim();
        const email    = inputs[1].value.trim();
        const password = inputs[2].value.trim();

        if (!pseudo || !email || !password) {
          alert("All fields are required");
          return;
        }

        try {
          const res = await fetch("http://localhost:3000/api/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ pseudo, email, password })
          });
          const data = await res.json();

          if (res.ok) {
            alert("Signup successful!");
            history.pushState({ page: "login" }, "", "#login");
            showView("login");
          } else {
            alert(data.error || "Signup error");
          }
        } catch (err) {
          console.error(err);
          alert("Network error");
        }
      });

      /* ----------- Login ----------- */
      const signinBtn = document.getElementById("btn-signin");
      signinBtn.addEventListener("click", async () => {
        const inputs = loginOptions.querySelectorAll("input");
        const email    = inputs[0].value.trim();
        const password = inputs[1].value.trim();

        if (!email || !password) {
          alert("Email and password are required");
          return;
        }

        try {
          const res = await fetch("http://localhost:3000/api/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
          });
          const data = await res.json();

          if (res.ok) {
            localStorage.setItem("authToken", data.token);
            alert("Login successful!");
            showView("home");
            // you could now call /api/me to display the profile
          } else {
            alert(data.error || "Login error");
          }
        } catch (err) {
          console.error(err);
          alert("Network error");
        }
      });
    </script>
  </body>
</html>
